{{- $title := .Get "title" | default "" -}}

{{- $path := strings.TrimRight "/" (.Get "path") -}}

{{- $split := split $path "#" -}}

{{- $url := strings.TrimRight "/" (index $split 0) -}}
{{- $anchor := index $split 1 | default "" -}}

{{- if ne (path.Ext $url) ".md" -}}
  {{- $url := print $url ".md" -}}
{{- end -}}

{{- $page := .Site.GetPage $url -}}

{{- if not $page -}}
  {{- $dummy := errorf "Page not found. URL: %s title: %s" $path $title -}}
{{- else -}}
  {{- with $page -}}
    <a href="{{ .Permalink | replaceRE "[^/]*$" "" }}{{if ne $anchor ""}}#{{ $anchor }}{{end}}">{{if ne $title ""}}{{ $title | markdownify | safeHTML }}{{ else }}{{ .Params.Chapter }}: {{ .Title }}{{end}}</a>
  {{- end -}}
{{- end -}}
